!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o(require("three")):"function"==typeof define&&define.amd?define(["three"],o):e.EarthControls=o(e.THREE)}(this,function(e){"use strict";var o=o=function(o,t,n){var i=3.141592653589793,a=2*i,d=this,r=-1,c=0,s=1,h=2;this.object=o,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1,this.panSpeed=1,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.dynamicDampingFactor=.2,this.earthRadius=void 0!==n?n.radius:6371,this.coord=void 0!==n.coord?new e.Vector2(n.coord[0],n.coord[1]):new e.Vector2(0,1.5707963267948966),this.zoom=void 0!==n.zoom?n.zoom:10,this.pitch=void 0!==n.pitch?n.pitch:0,this.bearing=void 0!==n.bearing?n.bearing:0,this.coordEnd=this.coord.clone(),this.zoomEnd=this.zoom,this.pitchEnd=this.pitch,this.bearingEnd=this.bearing,this.minZoom=1,this.maxZoom=18,this.globeZoom=10,this.maxPitch=80;var m=r,p=new e.Vector2,l=new e.Vector2,u={type:"change"},E=function(e){("end"!==e||u.type)&&(u.type=e,d.dispatchEvent(u),"end"===e&&(u.type=null))};this.jumpTo=function(o){this.coordEnd=void 0!==o.coord?new e.Vector2(o.coord[0],o.coord[1]):d.coordEnd,this.zoomEnd=void 0!==o.zoom?o.zoom:d.zoomEnd,this.pitchEnd=void 0!==o.pitch?o.pitch:d.pitchEnd,this.bearingEnd=void 0!==o.bearing?o.bearing:d.bearingEnd},this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),o=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-o.clientLeft,this.screen.top=e.top+window.pageYOffset-o.clientTop,this.screen.width=e.width,this.screen.height=e.height}};var b,g=(b=new e.Vector2,function(e,o){return b.set((e-d.screen.left)/d.screen.width,(o-d.screen.top)/d.screen.height),b}),v=function(e){!1!==d.enabled&&(e.preventDefault(),e.stopPropagation(),m===r&&(m=e.button),(m===c&&!d.noRotate||m===s&&!d.noZoom||m===h&&!d.noPan)&&(l.copy(g(e.pageX,e.pageY)),p.copy(l)),document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",z,!1))},f=function(o){if(!1!==d.enabled){o.preventDefault(),o.stopPropagation(),l.copy(g(o.pageX,o.pageY));var t,n,a=l.clone().sub(p);if(p.copy(l),m!==c||d.noRotate)m!==s||d.noZoom?m!==h||d.noPan||(d.zoom<d.globeZoom?(Math.abs(a.y)>.05&&Math.abs(a.x)>.05||Math.abs(a.y)<Math.abs(a.x))&&(l.y<.5?d.bearingEnd=d.bearing+a.x*d.panSpeed*24:d.bearingEnd=d.bearing-a.x*d.panSpeed*24):d.bearingEnd=0,(Math.abs(a.y)>.05&&Math.abs(a.x)>.05||Math.abs(a.x)<Math.abs(a.y))&&(d.pitchEnd=e.Math.clamp(d.pitch-a.y*d.panSpeed*320,0,d.maxPitch))):(d.zoomEnd=e.Math.clamp(d.zoom+a.y*d.zoomSpeed*32,d.minZoom,d.maxZoom),d.zoomEnd>d.globeZoom&&(d.bearingEnd=0));else{Math.abs(a.y)<.01&&Math.abs(a.x)>.02&&(a.y=0),Math.abs(a.x)<.01&&Math.abs(a.y)>.02&&(a.x=0);var r=(t=a,n=Math.pow(2,d.zoom-1)*d.rotateSpeed*1e-4,t.clone().rotateAround(new e.Vector2(0,0),-d.bearing).multiplyScalar(n));d.coordEnd.x=d.coord.x-r.x,d.coordEnd.y=e.Math.clamp(d.coord.y-r.y,0,i)}}},z=function(e){!1!==d.enabled&&(e.preventDefault(),e.stopPropagation(),m=r,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",z))},y=function(o){if(!1!==d.enabled){switch(o.preventDefault(),o.stopPropagation(),o.deltaMode){case 2:d.zoomEnd=e.Math.clamp(d.zoom+.025*o.deltaY*d.zoomSpeed*32,d.minZoom,d.maxZoom);break;case 1:d.zoomEnd=e.Math.clamp(d.zoom+.01*o.deltaY*d.zoomSpeed*32,d.minZoom,d.maxZoom);break;default:d.zoomEnd=e.Math.clamp(d.zoom+25e-5*o.deltaY*d.zoomSpeed*32,d.minZoom,d.maxZoom)}d.zoomEnd>d.globeZoom&&(d.bearingEnd=0)}},w=function(e){!1!==d.enabled&&e.preventDefault()};this.dispose=function(){this.domElement.removeEventListener("contextmenu",w,!1),this.domElement.removeEventListener("mousedown",v,!1),this.domElement.removeEventListener("wheel",y,!1),document.removeEventListener("mousemove",f,!1),document.removeEventListener("mouseup",z,!1)},this.domElement.addEventListener("contextmenu",w,!1),this.domElement.addEventListener("mousedown",v,!1),this.domElement.addEventListener("wheel",y,!1),this.handleResize(),this.update=function(){var o=d.dynamicDampingFactor,t=d.coordEnd.clone().sub(d.coord),n=d.zoomEnd-d.zoom,r=d.bearingEnd-d.bearing,c=d.pitchEnd-d.pitch;if(Math.abs(t.x)>1e-6||Math.abs(t.y)>1e-6||Math.abs(n)>1e-6||Math.abs(r)>1e-6||Math.abs(c)>1e-6)d.coord.x+=t.x*o,d.coord.y+=t.y*o,d.zoom+=n*o,d.bearing+=r*o,d.pitch+=c*o,d.needsUpdate=!0;else{for(;d.coordEnd.x<0;)d.coordEnd.x+=a;for(d.coordEnd.x=d.coordEnd.x%a,d.coord.copy(d.coordEnd),d.zoom=d.zoomEnd;d.bearingEnd<0;)d.bearingEnd+=a;d.bearing=d.bearingEnd=d.bearingEnd%a,d.pitch=d.pitchEnd}if(d.needsUpdate){var s=new e.Spherical(d.earthRadius,d.coord.y,d.coord.x);s.makeSafe();var h=(new e.Vector3).setFromSpherical(s),m=function(o){var t=Math.pow(1.9,d.zoom-1)*d.earthRadius/3e4,n=(new e.Vector3).setFromSpherical(o);o.phi-=1e-6;var a=(new e.Vector3).setFromSpherical(o).sub(n).normalize();return a.applyAxisAngle(n.clone().normalize(),d.bearing+i),d.pitch<1e-6&&(d.pitch=1e-6),n.normalize().multiplyScalar(Math.tan((90-d.pitch)/180*i)).clone().add(a).normalize().multiplyScalar(t)}(s);d.object.position.copy(h.clone().add(m)),d.pitch<1e-6&&(d.pitch=1e-6);var p=h.clone().normalize().multiplyScalar(m.length()/Math.cos(d.pitch/180*i));d.object.up=p.sub(m).normalize(),d.object.lookAt(h),E("change"),d.needsUpdate=!1}else E("end")},this.needsUpdate=!0,this.update()};return o.prototype=Object.create(e.EventDispatcher.prototype),o});
