!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("three")):"function"==typeof define&&define.amd?define(["three"],t):e.MapControls=t(e.THREE)}(this,function(e){"use strict";var t=t=function(t,o,n){var i=3.141592653589793,a=i/2,d=2*i,r=this,c=-1,s=0,h=1,m=2;this.object=t,this.domElement=void 0!==o?o:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1,this.panSpeed=1,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.dynamicDampingFactor=.2,this.earthRadius=void 0!==n?n.radius:6371,this.coord=void 0!==n.coord?new e.Vector2(n.coord[0],n.coord[1]):new e.Vector2(0,a),this.zoom=void 0!==n.zoom?n.zoom:10,this.pitch=void 0!==n.pitch?n.pitch:0,this.bearing=void 0!==n.bearing?n.bearing:0,this.coordEnd=this.coord.clone(),this.zoomEnd=this.zoom,this.pitchEnd=this.pitch,this.bearingEnd=this.bearing,this.minZoom=1,this.maxZoom=18,this.maxPitch=80;var p=c,l=new e.Vector2,u=new e.Vector2,E={type:"change"},b=function(e){("end"!==e||E.type)&&(E.type=e,r.dispatchEvent(E),"end"===e&&(E.type=null))};this.getVisibleExtent=function(){return this.zoom*this.zoom*Math.min(90/(90-this.pitch),1.5)/180},this.jumpTo=function(t){this.coordEnd=void 0!==t.coord?new e.Vector2(t.coord[0],t.coord[1]):r.coordEnd,this.zoomEnd=void 0!==t.zoom?t.zoom:r.zoomEnd,this.pitchEnd=void 0!==t.pitch?t.pitch:r.pitchEnd,this.bearingEnd=void 0!==t.bearing?t.bearing:r.bearingEnd},this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}};var v,g=(v=new e.Vector2,function(e,t){return v.set((e-r.screen.left)/r.screen.width,(t-r.screen.top)/r.screen.height),v}),f=function(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),p===c&&(p=e.button),(p===s&&!r.noRotate||p===h&&!r.noZoom||p===m&&!r.noPan)&&(u.copy(g(e.pageX,e.pageY)),l.copy(u)),document.addEventListener("mousemove",z,!1),document.addEventListener("mouseup",y,!1))},z=function(t){if(!1!==r.enabled){t.preventDefault(),t.stopPropagation(),u.copy(g(t.pageX,t.pageY));var o,n,a=u.clone().sub(l);if(l.copy(u),p!==s||r.noRotate)p!==h||r.noZoom?p!==m||r.noPan||((Math.abs(a.y)>.015&&Math.abs(a.x)>.015||Math.abs(a.y)<.015)&&(u.y<.5?r.bearingEnd=r.bearing+a.x*r.panSpeed*24:r.bearingEnd=r.bearing-a.x*r.panSpeed*24),(Math.abs(a.y)>.015&&Math.abs(a.x)>.015||Math.abs(a.x)<.015)&&(r.pitchEnd=e.Math.clamp(r.pitch-a.y*r.panSpeed*320,0,r.maxPitch))):r.zoomEnd=e.Math.clamp(r.zoom+a.y*r.zoomSpeed*32,r.minZoom,r.maxZoom);else{Math.abs(a.y)<.01&&Math.abs(a.x)>.01&&(a.y=0),Math.abs(a.x)<.01&&Math.abs(a.y)>.01&&(a.x=0);var d=(o=a,n=Math.pow(2,r.zoom-1)*r.rotateSpeed*1e-4,o.clone().rotateAround(new e.Vector2(0,0),-r.bearing).multiplyScalar(n));r.coordEnd.x=r.coord.x-d.x,r.coordEnd.y=e.Math.clamp(r.coord.y-d.y,0,i)}}},y=function(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),p=c,document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",y))},w=function(t){if(!1!==r.enabled)switch(t.preventDefault(),t.stopPropagation(),t.deltaMode){case 2:r.zoomEnd=e.Math.clamp(r.zoom+.025*t.deltaY*r.zoomSpeed*32,r.minZoom,r.maxZoom);break;case 1:r.zoomEnd=e.Math.clamp(r.zoom+.01*t.deltaY*r.zoomSpeed*32,r.minZoom,r.maxZoom);break;default:r.zoomEnd=e.Math.clamp(r.zoom+25e-5*t.deltaY*r.zoomSpeed*32,r.minZoom,r.maxZoom)}},x=function(e){!1!==r.enabled&&e.preventDefault()};this.dispose=function(){this.domElement.removeEventListener("contextmenu",x,!1),this.domElement.removeEventListener("mousedown",f,!1),this.domElement.removeEventListener("wheel",w,!1),document.removeEventListener("mousemove",z,!1),document.removeEventListener("mouseup",y,!1)},this.domElement.addEventListener("contextmenu",x,!1),this.domElement.addEventListener("mousedown",f,!1),this.domElement.addEventListener("wheel",w,!1),this.handleResize(),this.update=function(){var t=r.dynamicDampingFactor,o=r.coordEnd.clone().sub(r.coord),n=r.zoomEnd-r.zoom,c=r.bearingEnd-r.bearing,s=r.pitchEnd-r.pitch;if(Math.abs(o.x)>1e-6||Math.abs(o.y)>1e-6||Math.abs(n)>1e-6||Math.abs(c)>1e-6||Math.abs(s)>1e-6?(r.coord.x+=o.x*t,r.coord.y+=o.y*t,r.zoom+=n*t,r.bearing+=c*t,r.pitch+=s*t,r.needsUpdate=!0):(r.coordEnd.x=(r.coordEnd.x+d)%d,r.coord.copy(r.coordEnd),r.zoom=r.zoomEnd,r.bearing=r.bearingEnd=(r.bearingEnd+d)%d,r.pitch=r.pitchEnd),r.needsUpdate){var h=new e.Spherical(r.earthRadius,r.coord.y,r.coord.x);h.makeSafe();var m=(new e.Vector3).setFromSpherical(h),p=function(t){var o=Math.pow(2,r.zoom-1)*r.earthRadius/1e5,n=(new e.Vector3).setFromSpherical(t);t.phi-=1e-5;var a=(new e.Vector3).setFromSpherical(t).sub(n).normalize();return a.applyAxisAngle(n.clone().normalize(),r.bearing+i),r.pitch>.1?n.normalize().multiplyScalar(Math.tan((90-r.pitch)/180*i)).clone().add(a).normalize().multiplyScalar(o):n.clone().normalize().multiplyScalar(o)}(h);if(r.object.position.copy(m.clone().add(p)),r.pitch>.1){var l=m.clone().normalize().multiplyScalar(p.length()/Math.cos(r.pitch/180*i));r.object.up=l.sub(p).normalize()}else r.object.up=new e.Vector3(Math.cos(a+r.bearing),Math.sin(a+r.bearing),0);r.object.lookAt(m),b("change"),r.needsUpdate=!1}else b("end")},this.needsUpdate=!0,this.update()};return t.prototype=Object.create(e.EventDispatcher.prototype),t});
